package errcheckfix

import (
	"errors"
	"fmt"
	"testing"

	qt "github.com/frankban/quicktest"
)

func returnsErr() error {
	return errors.New("boom")
}

func returnsTwo() (int, error) {
	return 42, errors.New("boom")
}

func TestFatalAfterAssign(t *testing.T) {
	c := qt.New(t)

	err := returnsErr()
	c.Assert(err, qt.IsNil, qt.Commentf("%v", err))

	c.Assert(1, qt.Equals, 1)
}

func TestErrorAfterAssign(t *testing.T) {
	c := qt.New(t)

	err := returnsErr()
	c.Check(err, qt.IsNil, qt.Commentf("unexpected: %v", err))

	c.Assert(1, qt.Equals, 1)
}

func TestMultiValueAssign(t *testing.T) {
	c := qt.New(t)

	v, err := returnsTwo()
	c.Assert(err, qt.IsNil, qt.Commentf("unexpected: %v", err))
	_ = v

	c.Assert(1, qt.Equals, 1)
}

func TestIfInit(t *testing.T) {
	c := qt.New(t)

	{
		err := returnsErr()
		c.Assert(err, qt.IsNil, qt.Commentf("%v", err))
	}

	c.Assert(1, qt.Equals, 1)
}

func TestFatalMultipleArgs(t *testing.T) {
	c := qt.New(t)

	err := returnsErr()
	c.Assert(err, qt.IsNil, qt.Commentf("%v %v %v", "unexpected:", err, 123))

	c.Assert(1, qt.Equals, 1)
}

func TestErrorMultipleArgs(t *testing.T) {
	c := qt.New(t)

	err := returnsErr()
	c.Check(err, qt.IsNil, qt.Commentf("%v %v %v", "unexpected:", err, 123))

	c.Assert(1, qt.Equals, 1)
}

func TestErrorfMultipleArgs(t *testing.T) {
	c := qt.New(t)

	err := returnsErr()
	c.Check(err, qt.IsNil, qt.Commentf("unexpected: %v %v", err, 123))

	c.Assert(1, qt.Equals, 1)
}

func TestFatalfSpread(t *testing.T) {
	c := qt.New(t)

	err := returnsErr()
	args := []any{err, 123}
	c.Assert(err, qt.IsNil, qt.Commentf(fmt.Sprintf("unexpected: %v %v", args...)))

	c.Assert(1, qt.Equals, 1)
}

func TestFatalSpread(t *testing.T) {
	c := qt.New(t)

	err := returnsErr()
	args := []any{"unexpected:", err, 123}
	c.Assert(err, qt.IsNil, qt.Commentf(fmt.Sprint(args...)))

	c.Assert(1, qt.Equals, 1)
}
